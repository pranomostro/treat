#!/usr/bin/env rc

tmpdir=`{mktemp -d '/tmp/treat.XXXXXX'}

fifos=`{seq 0 $#*}
ins=$tmpdir^'/'^'in.'^$fifos
outs=$tmpdir^'/'^'out.'^$fifos

mkfifo $ins $outs

paste $outs &

for(i in `{seq 1 $#*})
	eval '<'$ins($i)' '$*($i)' >'$outs($i)' &'

cat <$ins($#ins) >$outs($#outs) &

splitup $ins

rm $ins $outs
rmdir $tmpdir
